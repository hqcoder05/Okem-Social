@model okem_social.Models.User
@{
    ViewData["Title"] = "Profile";

    string avatar = ViewBag.AvatarUrl as string ?? "/img/avatar-default.png";
    string handle = ViewBag.Handle    as string ?? ("@" + (Model.Email?.Split('@')[0] ?? "user"));

    int posts     = ViewBag.PostsCount     ?? 0;
    int followers = ViewBag.FollowersCount ?? 0;
    int following = ViewBag.FollowingCount ?? 0;
}

@section Styles{
    <link rel="stylesheet" href="~/css/profile-me.css" asp-append-version="true" />
}

<div class="container py-4 profile-me">
    <div class="card-dark card-me">
        <!-- Header chỉ giữ badge ID (nếu muốn) -->
        <div class="d-flex align-items-center justify-content-end card-header-me">
            <span class="badge-soft">ID #@Model.Id</span>
        </div>

        @if (TempData["ok"] != null) { <div class="alert alert-success">@TempData["ok"]</div> }
        @if (TempData["err"] != null) { <div class="alert alert-danger">@TempData["err"]</div> }

        <div class="row align-items-center g-4">
            <!-- Avatar -->
            <div class="col-12 col-md-3 d-flex justify-content-center">
                <div class="avatar-box">
                    <div class="avatar-ring">
                        <img src="@avatar" alt="avatar" class="avatar-lg">
                    </div>
                </div>
            </div>

            <!-- Thông tin -->
            <div class="col-12 col-md-9">
                <!-- Hàng trên: Tên + Nickname + Action buttons -->
                <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-3 mb-2">
                    <div>
                        <h1 class="mb-1" style="font-weight:800; line-height:1.15; font-size:clamp(1.4rem, 1.2rem + 1vw, 2rem);">
                            @Model.FullName
                        </h1>
                        <div class="text-muted" style="font-size:1.05rem;">@handle</div>
                    </div>

                    <div class="d-flex flex-wrap gap-2">
                        <a class="btn btn-ig" asp-controller="Profile" asp-action="Edit">Edit profile</a>
                        <a class="btn btn-ig" href="#">View archive</a>
                        <button class="btn btn-ig icon-only" type="button" title="Settings" aria-label="Settings">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="1.6"/>
                                <path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-1.2-2-3.4-2.3 1a7.9 7.9 0 0 0-5-.9L9.8 1H6.2L6 4.5a7.8 7.8 0 0 0-4 3l-2-.8L0 10l2.2 1a7.9 7.9 0 0 0 .1 2l-2.2 1 0 2.3 2 .8a7.8 7.8 0 0 0 4 3l.2 3.5h3.6l.4-3.6a7.9 7.9 0 0 0 5-.9l2.3 1 2-3.4-2-1.2Z"
                                      stroke="currentColor" stroke-width="1.2" opacity=".35"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <ul class="list-inline ig-stats mb-2">
                    <li class="list-inline-item"><b>@posts</b> posts</li>
                    <li class="list-inline-item">
                        <a class="link-muted" asp-controller="Users" asp-action="Followers" asp-route-id="@Model.Id">
                            <b>@followers</b> followers
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a class="link-muted" asp-controller="Users" asp-action="Following" asp-route-id="@Model.Id">
                            <b>@following</b> following
                        </a>
                    </li>
                </ul>

                <!-- Bio: chỉ hiển thị (sửa trong Edit Profile) -->
                @if (!string.IsNullOrWhiteSpace(Model.Bio))
                {
                    <div class="text-body" style="white-space:pre-line;">@Model.Bio</div>
                }
            </div>
        </div>

        <!-- Highlights (placeholder) -->
        <div class="ig-highlights my-4">
            <div class="ig-highlight">
                <div class="ring"><img src="@avatar" alt=""></div>
                <div class="caption">The Moment</div>
            </div>
            <div class="ig-highlight">
                <div class="ring empty"><span>+</span></div>
                <div class="caption">New</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="ig-tabs">
            <button class="tab active">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 3h7v7H3V3Zm11 0h7v7h-7V3ZM3 14h7v7H3v-7Zm11 0h7v7h-7v-7Z"/>
                </svg>
                <span>Posts</span>
            </button>
            <button class="tab">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V7Zm4-2 3 4m2-4 3 4" opacity=".6"/>
                </svg>
                <span>Reels</span>
            </button>
            <button class="tab">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 4h16v16H4z" opacity=".2"/>
                    <path d="M12 7a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 7Zm0 2.2A2.8 2.8 0 1 1 12 15.8 2.8 2.8 0 0 1 12 9.2Z"/>
                </svg>
                <span>Tagged</span>
            </button>
        </div>
        <hr class="ig-sep"/>

        <!-- Grid bài viết (placeholder) -->
        <div class="ig-grid">
            <div class="ig-grid-empty">Chưa có bài viết</div>
        </div>
    </div>
</div>
